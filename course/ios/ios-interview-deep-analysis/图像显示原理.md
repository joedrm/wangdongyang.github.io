## 图像显示的原理

CPU 和 GPU 是通过总线连接起来的。在 CPU 当中所输出的结果往往是一个位图，再经由总线在合适的时机上传给GPU。GPU拿到这个位图之后会做相应位图图层的渲染，包括纹理的合成。之后把这个结果放到帧缓冲区当中，由视频控制器根据垂直同步信号`VSync` 在指定时间之前读取对应帧缓冲区当中的数据并提交至屏幕控制器最终显示在屏幕上。

![-min.png](https://s2.loli.net/2025/04/18/3jKUQOaYgIiMHwB.png)

### CPU 和 GPU 分别做了哪些事？

当创建一个 UIView 控件的时候，它的显示部分由`CALayer`负责。`CALayer` 中有一个 `contents` 属性，就是我们最终要绘制到屏幕上面的一个位图。比如说创建的是一个`UILabel`， `contents` 里面放置的是关于 `hello world` 的一个文字位图。系统会在合适的时机通过回调方法让我们可以在此基础之上去绘制自定义的内容。绘制的位图最终会经由`CoreAnimation`框架提交给 `GPU` 部分的 `OpenGL` 渲染管线进行最终的位图的渲染，包括纹理的合成，最后显示到屏幕上面。

![CPU  GPU -min.png](https://s2.loli.net/2025/04/18/m2b3hLqT1doMRx6.png)

在虚线左侧都是发生在CPU上面的，而右侧这一部分 `OpenGL` 是发生在 GPU 层面上面的。

### CPU 工作

对于CPU来说，它需要完成UI的布局以及文本的计算，包括显示或者说绘制之后会做一些准备工作。然后把对应的位图提交到 GPU 上面。对应到实际开发中就是每一个控件，控件的`frame` 的设置，`label` 的文字计算，`size` 的计算，图片的编解码，最终由 CPU将位图结果进行提交。

![CPU-min.png](https://s2.loli.net/2025/04/18/bCDMekNIpFE7Qvr.png)

### GPU 渲染管线

- 顶点着色
- 图元装配
- 光栅化
- 片段着色
- 片段处理

这5个步骤做完之后，就会把最终的像素点提交到对应的帧缓冲区当中，然后由视频控制器在同步信号到来之前，去帧缓冲区取，最终显示到屏幕上面。
